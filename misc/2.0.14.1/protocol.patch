http://bzflag.svn.sourceforge.net/viewvc/bzflag/branches/v2_0branch/bzflag/src/bzfs/bzfs.cxx?view=patch&r1=20950&r2=20844
--- branches/v2_0branch/bzflag/src/bzfs/bzfs.cxx	2010/02/14 19:49:16	20844
+++ branches/v2_0branch/bzflag/src/bzfs/bzfs.cxx	2010/03/24 14:35:00	20950
@@ -3650,10 +3650,18 @@
 	  case MsgUDPLinkRequest:
 	  case MsgUDPLinkEstablished:
 	  case MsgWantSettings:
+	  case MsgExit:
+	  case MsgAlive:
 		  break;
 
+	  case MsgMessage:
+	  case MsgPlayerUpdateSmall:
+		  // FIXME: this is a workaround for a protocol problem
+		  logDebugMessage(2,"Ignoring premature message 0x%4hx from host %s\n",code,handler->getTargetIP());
+		  return;
+
 	  default:
-		  logDebugMessage(1,"Host %s tried to send invalid message before Enter; %d\n",handler->getHostname(),code);
+		  logDebugMessage(1,"Host %s tried to send invalid message before Enter; 0x%4hx\n",handler->getTargetIP(),code);
 		  rejectPlayer(t, RejectBadRequest, "invalid request");
 		  return;
 	  }
@@ -3672,6 +3680,13 @@
   switch (code) {
     // player joining
     case MsgEnter: {
+      // a previous MsgEnter will have set the name a few lines down from here
+      if (!playerData->accessInfo.getName().empty()) {
+	logDebugMessage(1,"Player %s [%d] sent another MsgEnter\n",
+	       playerData->player.getCallSign(), t);
+	rejectPlayer(t, RejectBadRequest, "invalid request");
+	break;
+      }
       uint16_t rejectCode;
       char     rejectMsg[MessageLen];
       if (!playerData->player.unpackEnter(buf, rejectCode, rejectMsg)) {
