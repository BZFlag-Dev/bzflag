<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <title>BZFS API Documentation: Introduction</title>
  <meta http-equiv="Content-Type"
 content="text/html; charset=iso-8859-1">
  <link rel="stylesheet" type="text/css"
 href="http://www.bzflag.org/general.css">
  <link href="http://www.bzflag.or/favicon.ico" rel="shortcut icon">
  <style type="text/css">
<!--
.style1 {
	font-size: 16px;
	font-weight: bold;
}
.style2 {font-size: 36px}
.style4 {font-size: 18px; font-weight: bold; }
.style5 {color: #999999}
.Code {	font-size: 16px;
	font-style: italic;
}
.style6 {font-weight: bold}
.style7 {font-size: 24px}
-->
  </style>
</head>
<body>
<table bgcolor="#dddddd" border="0" cellpadding="0" cellspacing="1"
 width="100%">
  <tbody>
    <tr height="50" valign="top">
      <td colspan="2">
      <table border="0" cellpadding="0" cellspacing="0" width="100%">
        <tbody>
          <tr>
            <td align="right" bgcolor="#013571"><img
 src="http://www.bzflag.org/images/logo2-1.jpg" alt="logo"></td>
            <td align="left" bgcolor="#818181"><img
 src="http://www.bzflag.org/images/logo2-2.jpg" alt=""></td>
          </tr>
        </tbody>
      </table>
      </td>
    </tr>
    <tr valign="top">
      <td>
      <table width="100%">
        <tbody>
          <tr>
            <td align="center" valign="top" width="14%">
            <table align="center" bgcolor="#ffffff" border="1"
 bordercolor="#000000" width="179">
              <tbody>
                <tr>
                  <td align="center"><span class="style4"> Contents </span></td>
                </tr>
                <tr>
                  <td align="center"> <strong>Overview</strong> </td>
                </tr>
                <tr>
                  <td align="center"> <a href="index.html">Introduction
                  </a> </td>
                </tr>
                <tr>
                  <td align="center"> <a href="general.html">General
Info </a> </td>
                </tr>
                <tr>
                  <td align="center"> <strong>Reference</strong> </td>
                </tr>
                <tr>
                  <td align="center"> <a href="entrys.html">Entries</a>
                  </td>
                </tr>
                <tr>
                </tr>
                <tr>
                  <td align="center"> <a href="types.html">Types</a> </td>
                </tr>
                <tr>
                </tr>
                <tr>
                  <td align="center"> <a href="events.html">Events</a>
                  </td>
                </tr>
                <tr>
                </tr>
                <tr>
                  <td align="center"> <a href="functions.html">Functions</a> </td>
                </tr>
                <tr>
                </tr>
                <tr>
                  <td align="center"> <strong>Examples</strong> </td>
                </tr>
                <tr>
                  <td align="center"> shockwaveDeath </td>
                </tr>
                <tr>
                </tr>
                <tr>
                  <td align="center"> scoreReset </td>
                </tr>
                <tr>
                </tr>
              </tbody>
            </table>
            </td>
            <td width="86%">
            <table align="left" bgcolor="#ffffff" border="0"
 cellpadding="2" cellspacing="2" width="100%">
              <tbody>
                <tr>
                  <td valign="top" class="style6">
                  <center>BZFS API Documentation</center>
                  </td>
                </tr>
                <tr>
                  <td align="left">
                  <p class="style1 style2" align="center">Calling BZFS Functions</p>
                  <p>Once you have your event in place, you need to do something with all this
data. To handle this the API provides a number of functions that can be
called directly. These functions will perform actions and return data about
the current game state.</p>
                  <p>&nbsp;</p>
                  <p>The functions are as follows:</p>
                  <p><span class="style4 style7">Player Data Functions </span></p>                  <p><strong>BZF_API bool bz_getPlayerByIndex ( int index, bz_PlayerRecord *playerRecord );</strong></p>
                  <p>This function will take a player index, and will return a new player data object in the playerRecord paramater. The player data class contains the following data:</p>
                  <table bgcolor="#dddddd" border="1">
                    <tbody>
                      <tr>
                        <td align="left" valign="top">
                          <table align="left" border="0" cellpadding="2" cellspacing="2">
                            <tbody>
                         
                              <tr>
                                <td><span class="Code">bz_PlayerRecord<br>
                {<br>
                                  </span>
                                    <blockquote class="Code"> 
                                      <p>
  int playerID; // id of the player<br>
  bzApiString callsign; // callsign the player is using<br>
  bzApiString email; // email address of the player <br>
  bz_eTeamType team; // team the player is on<br>
  float pos[3]; // last known position<br>
  float rot; // last known heading<br>
  bzApiString ipAddress; // the network address for this connection<br>
  bzApiString currentFlag; // the flag the user presently has<br>
  bzApiStrList flagHistory; // a list of all flags the user has had<br>
  bool spawned; // true if the user is in game as a tank<br>
  bool verified; // true if the user has been authenticated ether global or local<br>
  bool globalUser; // true if the user was verified from the global login system<br>
  bool admin; // true if the user is an admin<br>
  bzApiStrList groups; // a list of all the groups the user is a member of<br>
  int wins; // number of times this player has killed another<br>
  int losses; // number of times this player has died<br>
  int teamKills; // number of times the user has killed a teammate<br>
	</p>
                                    </blockquote>
                                    <p class="Code">}</p></td>
                              </tr>
                              <tr>
                                <td>&nbsp;</td>
                              </tr>
                            
                            </tbody>
                        </table></td>
                      </tr>
                    </tbody>
                  </table>                  
                  <p><span class="style6">bz_PlayerRecord</span> also contains the folowing methods, for ease of use. They just call the existing player functuions described below</p>
                  <p><strong>void update ( void );</strong><br> 
                    Calls <strong>bz_updatePlayerData</strong> on this player. </p>
                  <p><strong>bool hasPerm ( const char* perm );</strong><br>
Calls <strong>bz_hasPerm</strong> on this player. </p>
                  <p><strong>bool grantPerm ( const char* perm );</strong><br>
Calls <strong>bz_grantPerm</strong> on this player. </p>
                  <p><strong>bool revokePerm ( const char* perm );</strong><br>
Calls <strong>bz_revokePerm</strong> on this player. </p>
                  <p><strong>BZF_API bool bz_updatePlayerData ( bz_PlayerRecord *playerRecord );</strong><br>
                    Updates a playerRecord to its current data. This is the same as calling update on the bz_PlayerRecord class.</p>
                  <p><strong>BZF_API bool bz_getPlayerIndexList ( std::vector&lt;int&gt; *playerList )</strong>;<br>
                    Fills out the supplied list with a list of the IDs of all known users.</p>
                  <p><strong>BZF_API bool bz_freePlayerRecord ( bz_PlayerRecord *playerRecord );</strong><br>
                    This command will free the memory used by a Player Record Object. It must be called when a plug-in is done using the player data returned from <strong>bz_getPlayerByIndex</strong></p>
                  <p><strong>BZF_API bool bz_setPlayerWins (int playerId, int wins);</strong><br> 
                    This command will set the number of wins (kills) in the score for the specified player, and update all client scores. </p>
                  <p><strong>BZF_API bool bz_setPlayerLosses (int playerId, int losses);</strong><br>
This command will set the number of losses(deaths) in the score for the specified player, and update all client scores. </p>
                  <p><strong>BZF_API bool bz_setPlayerTKs(int playerId, int tks);</strong><br>
This command will set the number of TKs (teamkills) in the score for the specified player, and update all client scores. </p>
                  <p><strong>BZF_API bool bz_resetPlayerScore(int playerId);</strong><br>
This command will reset to zero the score and TKs of the specified player and update all clients.</p>
                  <p><strong>Permission functions </strong><br> 
                    The permission functions all take permsision names as input. These names are the same as the server uses in its users and groups files. All the standard permission names have been defined in the bzfsAPI.h file using the <strong>bz_perm_XXXXXXXX </strong>set of defines. Groups can have custom permissions, so if you want to use a non standard permission in your plugin, you can also use that name in
the &quot;hasPerm&quot; function. Custom permissions can only be read via the API, they can not be set. So the user will have to know to enter the permission name into his/her groups file.</p>
                  <p><strong>BZF_API bool bz_hasPerm ( int playerID, const char* perm );</strong><br> 
                    This function will return true if the user has the permission named in the perm paramater </p>
                  <p><strong>BZF_API bool bz_grantPerm ( int playerID, const char* perm );</strong><br>
This function will give the user the specified permission, and return true if the operation was successful.</p>                                    <p><strong>BZF_API bool bz_revokePerm ( int playerID, const char* perm );</strong><br>
This function will remove the specified permision from the user, and return true if the operation was successful.</p>
<p>&nbsp;</p>
<p><span class="style4 style7">Message Functions </span></p>
<p><strong>BZF_API bool bz_sendTextMessage (int from, int to, const char* message);</strong><br>
                    Sends a text message to the specified user. <strong>BZ_SERVER</strong> should be used for messages from the server. If the message is sent to <strong>BZ_ALL_USERS</strong> it will send the message to all connected users. Likewise if it is set to<strong>BZ_ADMIN_CHANNEL</strong> it will be sent to all users with the ADMINMESSAGERECEIVE permission.</p>
<p><strong>BZF_API bool bz_sentFetchResMessage ( int playerID, const char* URL );</strong><br>
Sends an update message to the specified player telling them they must have the file specified in the URL. At present this is only used for sounds files. </p><p>&nbsp;</p>
                  <p><span class="style4 style7">World Weapons Functions </span></p>
<p><strong>BZF_API bool bz_fireWorldWep ( bzApiString flagType, float lifetime, int fromPlayer, float *pos, float tilt, float direction, int shotID, float dt )</strong><br>
Adds a shot  of the specified type and with the specified paramaters to the world.
<strong>BZ_SERVER</strong> should be used as the fromPlayer for normal world weapons.</p>
                  <p>&nbsp;</p>
                  <p class="style4 style7">Time Functions </p>
<p><strong>BZF_API double bz_getCurrentTime ( void );</strong><br>
                    Returns the current server time in seconds ( time server has been alive ).</p>
                  <p><strong>BZF_API float bz_getMaxWaitTime ( void );</strong><br> 
                    Returns the maximum amount of time in seconds between <strong>bz_eTickEvent</strong> events </p>
                  <p><strong>BZF_API void bz_setMaxWaitTime ( float time );</strong><br>
Sets the maximum amount of time in seconds between <strong>bz_eTickEvent</strong> events. If another plugin or the base system has a lower maxium the lowest max will be used. </p>
                  <p><strong>BZF_API void bz_getLocaltime ( bz_localTime *ts );</strong><br> 
                    Returns the real world time on the OS of the server into the passed in <strong>bz_localTime</strong> structure, witch contains</p>
                  <table bgcolor="#dddddd" border="1">
                    <tbody>
                      <tr>
                        <td align="left" valign="top">
                          <table align="left" border="0" cellpadding="2"
 cellspacing="2">
                            <tbody>
                              <tr>
                                <td><span class="Code">typedef struct <br>
                {<br>
                                  </span>
                                    <blockquote class="Code">
int year;<br>
int month;<br>
int day;<br>
int hour;<br>
int minute;<br>
int second;<br>
bool daylightSavings;</blockquote>
                                    <p class="Code">}bz_localTime;</p></td>
                              </tr>
                            </tbody>
                        </table></td>
                      </tr>
                    </tbody>
                  </table>                  <p>&nbsp; </p>
<p><span class="style4 style7">BZDB Functions </span></p>
<p><strong>BZF_API double bz_getBZDBDouble ( const char* variable );</strong><br>
                      Queries the BZDB database for the specified value and returns it as a double</p>
                  <p><strong>BZF_API bzApiString bz_getBZDBString( const char* variable );</strong><br>
Queries the BZDB database for the specified value and returns it as a string</p>
                  <p><strong>BZF_API bool bz_getBZDBBool( const char* variable );</strong><br>
Queries the BZDB database for the specified value and returns it as a boolean (true if value is non zero)</p>
                  <p><strong>BZF_API int bz_getBZDBInt( const char* variable );</strong><br>
Queries the BZDB database for the specified value and returns it as an integer</p>
                  <p><strong>BZF_API bool bz_setBZDBDouble ( const char* variable, double val );</strong><br>
Sets the BZDB database item specified to the for the specified floating point value</p>
                  <p><strong>BZF_API bool bz_setBZDBString( const char* variable, const char *val );</strong><br>
Sets the BZDB database item specified to the for the specified string value</p>
                  <p><strong>BZF_API bool bz_setBZDBBool( const char* variable, bool val );</strong><br>
Sets the BZDB database item specified to the for the specified boolean value</p>
                  <p><strong>BZF_API bool bz_setBZDBInt( const char* variable, int val );</strong><br>
Sets the BZDB database item specified to the for the specified integer value</p>
                  <p>&nbsp;</p>
                  <p><span class="style4 style7">Logging Functions </span></p>
                  <p><strong>BZF_API void bz_debugMessage ( int debugLevel, const char* message );</strong><br>
Outputs the specified message if the current debug level is at least the specified level.</p>
                  <p>&nbsp;</p>
                  <p><span class="style4 style7">Player Admin  Functions </span></p>
                  <p><strong>BZF_API bool bz_kickUser ( int playerIndex, const char* reason, bool notify );</strong><br>
  Removes the specified user from the server. If notify is true, the user and adminisrators will be notified using the reason. </p>
                  <p><strong>BZF_API bool bz_IPBanUser ( int playerIndex, const char* ip, int time, const char* reason )</strong><br>
                    Adds an entry to the main banlist with the specified data.</p>
                  <p><strong>BZF_API bool bz_killPlayer ( int playeID, bool spawnOnBase );</strong><br>
                    Kills the specified player. If spawnOnBase is true, then the user will respawn back at his CTF base.</p>
                  <p>&nbsp;</p>
                  <p><span class="style4 style7">Spawn Functions </span></p>
                  <p><strong>BZF_API bool bz_getStandardSpawn ( int playeID, float pos[3], float *rot );</strong><br>
                    Returns a normaly calculated spawn position for the specified user.</p>
                  <p>&nbsp;</p>                  <p><span class="style4 style7">Flag Functions </span></p>                  
                  <p><strong>BZF_API bool bz_removePlayerFlag ( int playeID );</strong><br>
  Removes (zaps) the flag caried by the specified player </p>
                  <p><strong>BZF_API void bz_resetFlags ( bool onlyUnused );</strong><br>
  Removes (zaps) all flags on the map, exactly the same as the /flag reset command</p>
                  <p>&nbsp;</p>
                  <p><span class="style4 style7">Server Info  Functions </span></p>                  
                  <p><strong>BZF_API bool bz_getPublic( void );</strong><br>
  Returns true if the server is public </p>
                  <p><strong>BZF_API bzApiString bz_getPublicAddr( void );</strong><br>
  Returns the public address the server is using, will return an empty string if the server is not public </p>
                  <p><strong>BZF_API bzApiString bz_getPublicDescription( void );</strong><br>
  Returns the public description the server is using, will return an empty string if the server is not public </p>
                  <p><strong>BZF_API void bz_updateListServer ( void );</strong><br> 
                    Forces the server to do a list server update. </p>
                  <p>&nbsp;</p>
                  <p><span class="style4 style7">Team Score Functions </span></p>                  
                  <p><strong>BZF_API int bz_getTeamCount (bz_eTeamType team);</strong><br>
  Returns the player count of the specified team </p>
                  <p><strong>BZF_API int bz_getTeamScore (bz_eTeamType team );</strong><br>
  Returns the team score for the specified team </p>
                  <p><strong>BZF_API int bz_getTeamWins (bz_eTeamType team );</strong><br>
  Returns the team wins for the speficied team </p>
                  <p><strong>BZF_API int bz_getTeamLosses (bz_eTeamType team );</strong><br>
  Returns the team losses for the specified team </p>
                  <p><strong>BZF_API void bz_setTeamWins (bz_eTeamType team, int wins );</strong><br>
  Sets the team wins for the speficied team </p>                  
                  <p><strong>BZF_API void bz_setTeamLosses (bz_eTeamType team, int losses );</strong><br>
  Sets the team losses for the specified team </p>
                  <p><strong>BZF_API void bz_resetTeamScore (bz_eTeamType team );</strong><br> 
                    Resets to Zero the score for the specified team </p>
                  <p>&nbsp;</p>                  
                  <p><span class="style4 style7">Recording Functions </span></p>
                  <p><strong>BZF_API bool bz_saveRecBuf( const char * _filename, int seconds);</strong><br>
  If a record buffer it active this saves the last 'seconds' seconds of it into 
the file '_filename'. If _filename contains non-alphanumeric characters other than '.'
these will be replaced by '_'. If seconds is not given the whole buffer is saved. </p>
                  <p>&nbsp;</p>
                  <p><span class="style4 style7">Custom Slash Command Functions </span></p>
                  <p>A plug-in can register a special handler for a custom / command. This allows a plug-in to handle commands more easily than hooking into the UnknownSlashCommand Event.</p>
                  <p>Similar to other events, custom slash commands provide a pointer to a handler class that the plugin overrides using the function.</p>
                  <p><strong>BZF_API bool bz_registerCustomSlashCommand ( const char* command, bz_CustomSlashCommandHandler *handler );</strong></p>
                  <p>This command will register a cutom slash command with the name provided in the command paramater. You do NOT need to provide the &quot;/&quot; character in the command name. The handler pointer is to a class that has been derived from <strong>bz_CustomSlashCommandHandler</strong></p>
                  <table bgcolor="#dddddd" border="1">
                    <tbody>
                      <tr>
                        <td align="left" valign="top">
                          <table align="left" border="0" cellpadding="2" cellspacing="2">
                            <tbody>
                              <tr>
                                <td><span class="Code">class bz_CustomSlashCommandHandler<br>
                {<br>
                                  </span>                                    <blockquote class="Code"> public:<br>
virtual ~bz_CustomSlashCommandHandler(){};<br>
virtual bool handle ( int playerID, bzApiString command, bzApiString message, bzAPIStringList *params ) = 0;</blockquote>
                                    <p class="Code">};</p></td>
                              </tr>
                            </tbody>
                        </table></td>
                      </tr>
                    </tbody>
                  </table>
                  <p>When a player issues the command, the handler will have its handle method called and then it can then do whatever it needs to. The Message parameter to the handle function will contain all the text the user has entered, except the /command name itself. The Params item will contain a list of the text broken into a space delimited list. This is useful for commands that take paramaters. </p>
                  <p><strong>BZF_API bool bz_removeCustomSlashCommand ( const char* command );</strong><br> 
                    This command will remove a custom slash command from BZFS. Only one custom slash command per name can be installed at a time. It is a good idea to make your command name unique.</p
		  </td>
                </tr>
                <tr>
                  <td>
                  <div align="left"><a href="events.html">Previous</a></div>
                  <div align="right" class="style5">Next</div>
                  </td>
                </tr>
              </tbody>
            </table>            </td>
          </tr>
        </tbody>
      </table>
      </td>
    </tr>
    <tr valign="bottom">
      <td cellpadding="2" bgcolor="#000000">
      <table bgcolor="#ffffff" border="0" cellpadding="2" width="100%">
        <tbody>
          <tr>
            <td align="right"> <span class="copyright">copyright
&copy; <a href="http://www.bzflag.org/wiki/CurrentMaintainer">Current
Maintainer</a> 1993-2005&nbsp;</span> </td>
          </tr>
          <tr>
            <td>
            <table bgcolor="#ffffff" border="0" cellpadding="2"
 width="100%">
              <tbody>
                <tr>
                  <td align="center"> <a href="http://www.opengl.org/"><img
 src="http://www.bzflag.org//images/opengl.gif" alt="opengl" border="0"
 height="31" width="88"></a> <a
 href="http://sourceforge.net/project/?group_id=3248"><img
 src="http://sourceforge.net/sflogo.php?group_id=3248&amp;type=1"
 alt="sourceforge" border="0" height="31" width="88"></a> <a
 href="http://sourceforge.net/donate/index.php?group_id=3248"><img
 src="http://images.sourceforge.net/images/project-support.jpg"
 alt="Support This Project" border="0" height="32" width="88"> </a> <a
 href="http://www.linuxgames.com/"><img
 src="http://www.bzflag.org/images/linuxgames.gif" alt="linuxgames"
 border="0" height="31" width="88"></a> <a
 href="http://www.telefragged.com/"><img
 src="http://www.bzflag.org//images/telefragged.gif" alt="telefragged"
 border="0" height="31" width="88"></a> </td>
                </tr>
              </tbody>
            </table>
            </td>
          </tr>
        </tbody>
      </table>
      </td>
    </tr>
  </tbody>
</table>
</body>
</html>
