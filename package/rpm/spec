# bzflag
# Copyright 1993-1999, Chris Schoeneman
#
# This package is free software;  you can redistribute it and/or
# modify it under the terms of the license found in the file
# named LICENSE that should have accompanied this file.
#
# THIS PACKAGE IS PROVIDED ``AS IS'' AND WITHOUT ANY EXPRESS OR
# IMPLIED WARRANTIES, INCLUDING, WITHOUT LIMITATION, THE IMPLIED
# WARRANTIES OF MERCHANTIBILITY AND FITNESS FOR A PARTICULAR PURPOSE.
#
# bzflag RPM spec file
#   RPM is boneheaded in that it expects you to build and install
#   a package as part of the packaging.  dumb!  we'll hard link the
#   necessary files into an alternate root and have RPM look there.
#   we can also get RPM to put files in an alternate location by
#   using an external rpmrc file.
#
# thanks to Tim Riker (TimR@CalderaSystems.com) for improvements
# to this spec file.
#

%define name bzflag
%define version 1.7d.6
%define release 1

%define bzbasedir	/usr/X11R6/lib/X11/bzflag
%define bzbindir	%{bzbasedir}/bin
%define bzdatadir	%{bzbasedir}/data
%define bzmandir	/usr/man
%define bzdocdir	/usr/doc/%{name}-%{version}

name:		%{name}
version:	%{version}
release:	%{release}
group:		Recreation/Action
copyright:	Chris Schoeneman 1993-1999
packager:	Chris Schoeneman <crs23@bigfoot.com>
url:		http://www.bigfoot.com/~bzflag/
summary:	multiplayer 3D tank battle game
source:		http://www.bigfoot.com/~bzflag/packages/src/%{name}-%{version}.src.tar.gz
buildroot:	/var/tmp/%{name}-%{version}-%{release}-root

# all we want here is to remove glide, but RPM does not provide a way. ;-(
# [crs -- mesa 3.1 now uses libGL.so.1 and libGLU.so.1.  also, linking
#  against a mesa built without glide support avoids the glide dependency.]
#autoreqprov: no
#requires: ld-linux.so.2 libMesaGL.so.3 libMesaGLU.so.3 libX11.so.6
#requires: libXext.so.6 libc.so.6 libm.so.6 libstdc++.so.2.9

%description
bzflag is a networked multiplayer 3D tank battle game, combining
both fast action and strategy.  Free-for-all and capture-the-flag
styles are available.

%prep
%setup -q -c

%build
%ifarch ppc
make linux-ppc-noopt
%else
%ifarch i386 i486 i586 i686
make linux-i386-noopt
%else
make linux-noopt
%endif
%endif
make ACXXOPTS="$RPM_OPT_FLAGS" ACOPTS="$RPM_OPT_FLAGS"		\
	INSTALL_DATA_DIR=%{bzdatadir}				\
	all

%install
rm -rf $RPM_BUILD_ROOT
mkdir -p $RPM_BUILD_ROOT%{bzdocdir}
mkdir -p $RPM_BUILD_ROOT%{bzbindir}
mkdir -p $RPM_BUILD_ROOT%{bzdatadir}
mkdir -p $RPM_BUILD_ROOT%{bzmandir}/man6
mkdir -p $RPM_BUILD_ROOT/usr/X11R6/bin
install -m644 package/rpm/README.linux $RPM_BUILD_ROOT%{bzdocdir}/README
install -m644 LICENSE $RPM_BUILD_ROOT%{bzdocdir}
install -m644 man/*.6 $RPM_BUILD_ROOT%{bzmandir}/man6
gzip $RPM_BUILD_ROOT%{bzmandir}/man6/*.6
install -m644 data/*.rgb data/*.wav $RPM_BUILD_ROOT%{bzdatadir}
install bin/* $RPM_BUILD_ROOT%{bzbindir}
ln -s %{bzbindir}/bzflag $RPM_BUILD_ROOT/usr/X11R6/bin/bzflag
ln -s %{bzbindir}/bzfs $RPM_BUILD_ROOT/usr/X11R6/bin/bzfs

%clean
rm -rf $RPM_BUILD_ROOT

# note -- bzflag must be setuid root to use 3Dfx drivers without /dev/3dfx
%files
%defattr(-,root,root)
%dir %{bzdocdir}
%dir %{bzbindir}
%dir %{bzdatadir}
%dir %{bzbasedir}
%doc %{bzdocdir}/*
%doc %{bzmandir}/man6/*
%attr(755,root,root) /usr/X11R6/bin/*
%attr(755,root,root) %{bzbindir}/*
%attr(644,root,root) %{bzdatadir}/*
