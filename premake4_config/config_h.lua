--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

if (not _ACTION) then
  return
end

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

local sourceFile = nil

if (_ACTION:match('^vs')) then
  sourceFile = 'config_msvc.h'
elseif ((_ACTION == 'gmake') or
        (_ACTION == 'xcode3') or
        (_ACTION == 'codelite') or
        (_ACTION == 'codeblocks')) then
  sourceFile = 'config_ref.h'
end

if (not sourceFile) then
  return
end

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

print(('-'):rep(80))
print('Creating src/include/config.h')

-- read the original
local config_h_old = ''
do
  local f, err = io.open('../src/include/config.h', 'rt')
  if (f) then
    config_h_old = f:read('*a')
    f:close()
  end
end

-- generate the new text from the sourceFile and a header
local ref = assert(io.open(sourceFile))
local config_h_new = ref:read('*a')
ref:close()
config_h_new = '\n'
            .. '/* Generated by premake4_config/config_h.lua */\n'
            .. '\n'
            .. config_h_new
            .. '\n'

-- write the file, as required
if (config_h_new ~= config_h_old) then
  local f = assert(io.open('../src/include/config.h', 'wt'))
  f:write(config_h_new)
  f:close()
else
  print('-  src/include/config.h  is unchanged')
end

print(('-'):rep(80))

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------

local config_h = {

  have_isnan = nil,

  etc_inet_hosts = nil,

  half_rate_audio = nil,

  is_bigendian   = nil,
  is_ansi_const  = nil,
  socklen_t_type = nil,

  -- C++ headers
  have_cmath   = nil,
  have_cstdio  = nil,
  have_cstdlib = nil,
  have_cstring = nil,

  -- C headers
  have_sdl_sdl_h     = nil,
  have_bstring_h     = nil,
  have_dlfcn_h       = nil,
  have_dsound_h      = nil,
  have_fcntl_h       = nil,
  have_inttypes_h    = nil,
  have_linux_input_h = nil,
  have_process_h     = nil,
  have_sched_h       = nil,
  have_stdint_h      = nil,
  have_sys_param_h   = nil,
  have_sys_socket_h  = nil,
  have_netdb_h       = nil,
  have_unistd_h      = nil,
  have_values_h      = nil,
  have_regex_h       = nil,

  -- float math functions
  have_acosf  = nil,
  have_asinf  = nil,
  have_atan2f = nil,
  have_atanf  = nil,
  have_ceilf  = nil,
  have_cosf   = nil,
  have_expf   = nil,
  have_fabsf  = nil,
  have_floorf = nil,
  have_fmodf  = nil,
  have_hypotf = nil,
  have_logf   = nil,
  have_log10f = nil,
  have_powf   = nil,
  have_sinf   = nil,
  have_sqrtf  = nil,
  have_tanf   = nil,
}

--------------------------------------------------------------------------------
--------------------------------------------------------------------------------



